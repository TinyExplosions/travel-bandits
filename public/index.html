<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="precache" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Weather PWA">
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png">
    <link rel="stylesheet" href="/style.css">
    <meta name="description" content="Collated useful information from the Bandits">
    <meta name="theme-color" content="#EE2737" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Travel Bandits \o/</title>
</head>

<body id="travelBandits" class="home">
    <div id="hamburger">â˜°</div>
    <div class="wrapper">
        <ul id="locations">
            <header class="page-header">
                <h3>Travel Bandits \o/</h3>
            </header>
            <li class="location" id="ChIJ30HSXIUOZ0gRJNh5Fic-vUE"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">Mulligan's</h3>
                    <p>Guinness. Enough said.</p>
                </span></li>
            <li class="location" id="ChIJh3AytR4MZ0gRARyft5Gd05g"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">Locks Restaurant</h3>
                    <p>Tasty food, not terribly priced, well worth a meal</p>
                </span></li>
            <li class="location" id="ChIJQexzPZrGQkgRR_WHYrsxVso"><span class="tn"><img alt="hotel" src="/markers/hotel.png" /></span><span class="content">
                    <h3 class="hotel">The Tower</h3>
                    <p>Decent hotel in Waterford. Not the closest, but the best to stay in</p>
                </span></li>
            <li class="location" id="ChIJiUWj1VJd1moRWJdOTqGV1-0"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">Crown & Cushion</h3>
                    <p>Allegedly Haunted Pub. Decent enough food.</p>
                </span></li>
            <li class="location" id="ChIJqydp5TYrdEgRbg3TZ0IiOTY"><span class="tn"><img alt="office" src="/markers/office.png" /></span><span class="content">
                    <h3 class="office">Red Hat</h3>
                    <p>Red Hat Farnborough Office, often abbreviated to FAB</p>
                </span></li>
            <li class="location" id="ChIJq5uvnFPRdUgR4H9uB8X0voU"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">The Hub on the Park</h3>
                    <p>Central Cafe on Surrey Research Park</p>
                </span></li>
            <li class="location" id="ChIJOQvIs-bQdUgR1BR14AC0N9c"><span class="tn"><img alt="hotel" src="/markers/hotel.png" /></span><span class="content">
                    <h3 class="hotel">Holiday Inn Guildford</h3>
                    <p>Closest Hotel to Surrey Business Park.</p>
                </span></li>
            <li class="location" id="ChIJcfhu-h8DdkgRjcBLxNspos4"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">Brewdog Tower Hill</h3>
                    <p>An alternate local for the London Office, worth a visit.</p>
                </span></li>
            <li class="location" id="ChIJsyGzf1EDdkgReGdnA5-0CNY"><span class="tn"><img alt="office" src="/markers/office.png" /></span><span class="content">
                    <h3 class="office">Red Hat</h3>
                    <p>Red Hat London Office</p>
                </span></li>
            <li class="location" id="ChIJ39wsw1MDdkgRFYUxHsFjWk8"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">The Hydrant</h3>
                    <p>London Office local pub, will find folk there most nights.</p>
                </span></li>
            <li class="location" id="ChIJ4YrBPlIDdkgRtiUow9TNjKU"><span class="tn"><img alt="coffee" src="/markers/coffee.png" /></span><span class="content">
                    <h3 class="coffee">Black Sheep Coffee</h3>
                    <p>Nice coffee, close to office, 'nuff said.</p>
                </span></li>
            <li class="location" id="ChIJY1VDOK4EdkgRvQGI-ozL7NY"><span class="tn"><img alt="hotel" src="/markers/hotel.png" /></span><span class="content">
                    <h3 class="hotel">The Hoxton</h3>
                    <p>Small, quirky, design driven hotel near Blackfriars Bridge. Handy for the IBM Southbank Office.</p>
                </span></li>
            <li class="location" id="ChIJu6WS0LYEdkgR0j7F22iUGpc"><span class="tn"><img alt="office" src="/markers/office.png" /></span><span class="content">
                    <h3 class="office">IBM South Bank Office</h3>
                    <p>IBM Southbank Office.</p>
                </span></li>
            <li class="location" id="ChIJh1N-H1IDdkgRIPu2phakC6w"><span class="tn"><img alt="hotel" src="/markers/hotel.png" /></span><span class="content">
                    <h3 class="hotel">Premier Inn London Bank (Tower)</h3>
                    <p>Close hotel to office, not usually too expensive.</p>
                </span></li>
            <li class="location" id="ChIJzee0vroEdkgRsWQAXWfSU5Q"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">The Anchor and Hope</h3>
                    <p>Gastropub on The Cut, awesome food from a daily changing menu, nice wines, good bustling atmosphere. No bookings.</p>
                </span></li>
            <li class="location" id="ChIJ72L3z1sDdkgR2AYCjHUcNik"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">The Britannia</h3>
                    <p>Local boozer with huge whisky selection</p>
                </span></li>
            <li class="location" id="ChIJa2c6YVcDdkgRYAgQ0sCusN0"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">The Old Kings Head</h3>
                    <p>Small, hidden away local pub in the heart of the London Bridge/Borough Market area. </p>
                </span></li>
            <li class="location" id="ChIJo15e1lkDdkgR-X84Yf2cA0s"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">The George</h3>
                    <p>Old 17th Century Inn/Pub with original coach house features and courtyard which is excellent in the Summer. Only complaint is the beer (Greene King).</p>
                </span></li>
            <li class="location" id="ChIJz7OcRFgDdkgR0oz3h9Hoir0"><span class="tn"><img alt="pub" src="/markers/pub.png" /></span><span class="content">
                    <h3 class="pub">The Blue Eyed Maid</h3>
                    <p>Late night pub/bar open until 2am every day.</p>
                </span></li>
            <li class="location" id="ChIJedXQY1cDdkgR1fhRdBq76qQ"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">Cafe Rossi</h3>
                    <p>From breakfast falafel to a late night Kebab, always open and good too.</p>
                </span></li>
            <li class="location" id="ChIJy5YtMlgDdkgR3bbDOt2aGnQ"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">Shrigley's Moroccan Cuisine</h3>
                    <p>Great little cafe for Moroccan food at lunchtime.</p>
                </span></li>
            <li class="location" id="ChIJz7f06roEdkgRSZ92wK_1YzU"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">Meson Don Felipe</h3>
                    <p>Excellent Spanish Tapas Bar, with good tapas and decent selection of sherries. Great for post work, pre-train food and drinks.</p>
                </span></li>
            <li class="location" id="ChIJ6x9u4U5EcUgR2mjgkBZQtEs"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">The Jewel in the Crown</h3>
                    <p>Decent indian restaurant</p>
                </span></li>
            <li class="location" id="ChIJ1y_-JlJEcUgRINTTRuk-g7s"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">Los Gatos</h3>
                    <p>Good tapas</p>
                </span></li>
            <li class="location" id="ChIJL5BgJlJEcUgRYVyQlv7Tdrk"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">Helen Browning's Chop House</h3>
                    <p>Decent food, meat & 2 veg, but slightly fancy</p>
                </span></li>
            <li class="location" id="ChIJG6qx82J4dkgRIqJJ_S85GFc"><span class="tn"><img alt="restaurant" src="/markers/restaurant.png" /></span><span class="content">
                    <h3 class="restaurant">Stovell's</h3>
                    <p>Vaguely poncy, 4 Rosette restaurant in Chobham. Good food and wine, if a touch lacking in ambience IMHO.</p>
                </span></li>
        </ul>
        <!--The div element for the map -->
        <div id="map"></div>
        <script>
        var map;
        var markers = {};
        var infowindow;
        var mapCentre = { lat: 51.509990, lng: -0.085620 };
        // if (navigator.geolocation) {
        //     var test = navigator.geolocation.getCurrentPosition(setPosition);
        // }

        // function setPosition(position) {
        //     console.log("POSITION", position);
        //     mapCentre = { lat: position.coords.latitude, lng: position.coords.longitude };
        //     console.log(mapCentre);
        // }

        var icons = {
            "office": "/markers/office.png",
            "coffee": "/markers/coffee.png",
            "pub": "/markers/pub.png",
            "hotel": "/markers/hotel.png",
            "restaurant": "/markers/restaurant.png",
            "information": "/markers/information.png"
        }

        function sortLocations(locations) {
            locations.map(function(location, i) {
                location.distance = crowFlies(mapCentre.lat, mapCentre.lng, location.lat, location.lng);
                let el = document.getElementById(location["place_id"]);
                el.setAttribute('data-distance', location.distance);
                el.setAttribute('data-lat', location.lat);
                el.setAttribute('data-lng', location.lng);
            });
            locations = locations.sort(function(a, b) {
                return a.distance - b.distance;
            });
            let wrapper = document.getElementById("locations");
            let header = document.getElementsByClassName("page-header");
            let elements = document.createDocumentFragment();
            elements.appendChild(header[0].cloneNode(true));
            locations.forEach(function(item) {
                console.log(item['place_id']);
                elements.appendChild(document.getElementById(item["place_id"]).cloneNode(true));
            });
            wrapper.innerHTML = null;
            wrapper.appendChild(elements);
            wrapper.scrollTop = 0;
            let locators = document.getElementsByClassName('location');
            for (var i = 0; i < locators.length; i++) {
                locators[i].onclick = function() {
                    let marker = markers[this.getAttribute('id')];
                    marker.setZIndex(100);
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(function() {
                        marker.setAnimation(null);
                    }, 1420);
                    let lat = this.getAttribute('data-lat');
                    let lng = this.getAttribute('data-lng');
                    if (infowindow) {
                        infowindow.close();
                    }
                    mapCentre = { lat: parseFloat(lat), lng: parseFloat(lng) };
                    map.setCenter({ lat: parseFloat(lat), lng: parseFloat(lng) });
                    // sortLocations(locations);
                }
            };
        }
        // Initialize and add the map
        function initMap() {

            // The map, centered at Monument
            map = new google.maps.Map(
                document.getElementById('map'), { zoom: 16, center: mapCentre, gestureHandling: 'greedy', disableDefaultUI: true });

            locations.map(function(location, i) {
                let contentString = '<p><strong><a href="' + location.website + '">' + location.name + '</a></strong></p>' +
                    '<p>' + location.address + '</p>' +
                    '<p>' + location.comment + '</p>';


                let marker = new google.maps.Marker({
                    position: { lat: location.lat, lng: location.lng },
                    map: map,
                    title: location.name,
                    icon: { url: icons[location.type] || icons['information'], scaledSize: new google.maps.Size(32, 37) },
                });
                marker.addListener('click', function() {
                    if (infowindow) {
                        infowindow.close();
                    }
                    infowindow = new google.maps.InfoWindow({
                        content: contentString
                    });
                    infowindow.open(map, marker);
                });
                markers[location['place_id']] = marker;
                return marker;
            });
            sortLocations(locations);


            // var markerCluster = new MarkerClusterer(map, markers, {
            //     imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'
            // });
            // var marker = new google.maps.Marker({ position: monument, map: map, icon: "http://localhost:8080/public/redhat.png" });
            // var fabMarker = new google.maps.Marker({ position: fab, map: map, icon: "http://localhost:8080/public/redhat.png" });


        }

        function crowFlies(lat1, lng1, lat2, lng2) {
            var p = 0.017453292519943295;
            var c = Math.cos;
            var a = 0.5 - c((lat2 - lat1) * p) / 2 +
                c(lat1 * p) * c(lat2 * p) *
                (1 - c((lng2 - lng1) * p)) / 2;
            return (12742 * Math.asin(Math.sqrt(a))).toFixed(2);
        }

        document.getElementById("hamburger").onclick = function hamburgler() {
            var travelBandits = document.getElementById("travelBandits");
            travelBandits.classList.add("menu--animatable");

            if (travelBandits.classList.contains('show')) {
                travelBandits.classList.remove('show');
            } else {
                travelBandits.classList.add('show');
            }
        };

        function OnTransitionEnd() {
            document.getElementById("travelBandits").classList.remove("menu--animatable");
        }
        document.getElementById("locations").addEventListener("transitionend", OnTransitionEnd, false);
        </script>
        <script src="/locations.js"></script>
        <!-- <script src="/markerClusterer.js"></script> -->
        <script async defer src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyAbaFuSO_Z-2HceI05s1jiO-ktOU3FCSzk&callback=initMap">
        </script>
        <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((reg) => {
                        console.log('Service worker registered.', reg);
                    });
            });
        }
        </script>
    </div>
</body>

</html>